<html>
    <head>
        <script src='../lib/ce.js' type='text/javascript'>
        </script>
        <script  type='text/javascript'>

            window.onload = function () {
                window.onkeypress = function (ev) {
                    if (ev.charCode===96) {
                        chainConvert();
                        return false;
                    } else if (ev.charCode==114) {
                    }
                }
                chainConvert();
            }

            function htmlesc (html) {
                return html.replace(/&/g,
                    '&amp;').replace(/</g, '&lt;').replace(/>/g,
                        '&gt;').replace(/"/g, '&quot;');
            }

            function chainConvert () {
                var html1 = document.getElementById('html1');
                var dom1 = document.getElementById('dom1');
                var rtf1 = document.getElementById('rtf1');
                var html2 = document.getElementById('html2');
                var dom2 = document.getElementById('dom2');
                var rtf2 = document.getElementById('rtf2');
                var html3 = document.getElementById('html3');
                var dom3 = document.getElementById('dom3');
                var rtf3 = document.getElementById('rtf3');

                var rtfI = normalizeRTF(dom2rtf(dom1.firstChild));
                rtf1.innerHTML = JSON.stringify(rtfI);
                html1.innerHTML = htmlesc(rtf2html(rtfI));

                var htmlII = rtf2html(rtfI);
                html2.innerHTML = htmlesc(htmlII);
                dom2.innerHTML = htmlII;
                var rtfII = normalizeRTF(dom2rtf(dom2.firstChild));
                rtf2.innerHTML = JSON.stringify(rtfII);

                var htmlIII = rtf2html(rtfII);
                html3.innerHTML = htmlesc(htmlIII);
                dom3.innerHTML = htmlIII;
                var rtfIII = normalizeRTF(dom2rtf(dom3.firstChild));
                rtf3.innerHTML = JSON.stringify(rtfIII);
            }
        </script>
        <style>
            table {
                width: 100%;
            }
            td {
                width: 32%;
            }
            td:nth-child(1) {
                white-space: pre-wrap;
                background: #ffe;
            }
            td:nth-child(2) {
                background: #fef;
            }
            td:nth-child(3) {
                background: #eff;
            }
        </style>
    </head>
    <body>
        <table style='width:98%; whiteSpace: pre-wrap'>
            <tr>
                <td id='html1'>HTML</td>
                <td id='dom1' contentEditable='true'>
<h1>DOM</h1>
<p><span>line1</span></p>
<p><span>line2 has </span><span style="font-weight:
    bold">some bold</span></p>
                </td>
                <td id='rtf1'>Rich text</td>
            </tr>
            <tr>
                <td id='html2'>HTML</td>
                <td id='dom2'>DOM</td>
                <td id='rtf2'>Rich text</td>
            </tr>
            <tr>
                <td id='html3'>HTML</td>
                <td id='dom3'>DOM</td>
                <td id='rtf3'>Rich text</td>
            </tr>
        </table>
    </body>
</html>

